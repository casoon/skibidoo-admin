---
import SettingsLayout from "@/layouts/SettingsLayout.astro";
---

<SettingsLayout>
  <div class="space-y-6" x-data="generalSettings()">
    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-bold text-gray-900">Allgemeine Einstellungen</h1>
      <button
        @click="save()"
        :disabled="saving"
        class="rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700 disabled:opacity-50"
      >
        <span x-show="!saving">Speichern</span>
        <span x-show="saving">Wird gespeichert...</span>
      </button>
    </div>

    <!-- Shop Info -->
    <div class="rounded-lg bg-white p-6 shadow">
      <h2 class="mb-4 text-lg font-semibold">Shop-Informationen</h2>
      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label class="block text-sm font-medium text-gray-700">Shop-Name *</label>
          <input type="text" x-model="settings.shopName" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">E-Mail *</label>
          <input type="email" x-model="settings.email" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Telefon</label>
          <input type="tel" x-model="settings.phone" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Website</label>
          <input type="url" x-model="settings.website" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
      </div>
    </div>

    <!-- Address -->
    <div class="rounded-lg bg-white p-6 shadow">
      <h2 class="mb-4 text-lg font-semibold">Adresse</h2>
      <div class="grid gap-4 md:grid-cols-2">
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700">Strasse *</label>
          <input type="text" x-model="settings.address.street" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">PLZ *</label>
          <input type="text" x-model="settings.address.zip" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Stadt *</label>
          <input type="text" x-model="settings.address.city" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Land *</label>
          <select x-model="settings.address.country" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2">
            <option value="DE">Deutschland</option>
            <option value="AT">Oesterreich</option>
            <option value="CH">Schweiz</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Legal -->
    <div class="rounded-lg bg-white p-6 shadow">
      <h2 class="mb-4 text-lg font-semibold">Rechtliche Angaben</h2>
      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label class="block text-sm font-medium text-gray-700">Firmenname</label>
          <input type="text" x-model="settings.companyName" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Rechtsform</label>
          <select x-model="settings.legalForm" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2">
            <option value="">Keine Angabe</option>
            <option value="gmbh">GmbH</option>
            <option value="ug">UG (haftungsbeschraenkt)</option>
            <option value="ag">AG</option>
            <option value="ohg">OHG</option>
            <option value="kg">KG</option>
            <option value="einzelunternehmen">Einzelunternehmen</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">USt-IdNr.</label>
          <input type="text" x-model="settings.taxId" placeholder="DE123456789" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Handelsregister</label>
          <input type="text" x-model="settings.registrationNumber" placeholder="HRB 12345" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
      </div>
    </div>

    <!-- Bank Details -->
    <div class="rounded-lg bg-white p-6 shadow">
      <h2 class="mb-4 text-lg font-semibold">Bankverbindung</h2>
      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label class="block text-sm font-medium text-gray-700">Bank</label>
          <input type="text" x-model="settings.bank.name" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">IBAN</label>
          <input type="text" x-model="settings.bank.iban" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">BIC</label>
          <input type="text" x-model="settings.bank.bic" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2" />
        </div>
      </div>
    </div>

    <!-- Currency & Locale -->
    <div class="rounded-lg bg-white p-6 shadow">
      <h2 class="mb-4 text-lg font-semibold">Waehrung & Sprache</h2>
      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label class="block text-sm font-medium text-gray-700">Waehrung</label>
          <select x-model="settings.currency" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2">
            <option value="EUR">Euro (EUR)</option>
            <option value="CHF">Schweizer Franken (CHF)</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Sprache</label>
          <select x-model="settings.locale" class="mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2">
            <option value="de-DE">Deutsch (Deutschland)</option>
            <option value="de-AT">Deutsch (Oesterreich)</option>
            <option value="de-CH">Deutsch (Schweiz)</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <script>
    function generalSettings() {
      return {
        settings: {
          shopName: "Skibidoo",
          email: "info@skibidoo.de",
          phone: "",
          website: "https://skibidoo.de",
          address: {
            street: "",
            zip: "",
            city: "",
            country: "DE",
          },
          companyName: "",
          legalForm: "",
          taxId: "",
          registrationNumber: "",
          bank: {
            name: "",
            iban: "",
            bic: "",
          },
          currency: "EUR",
          locale: "de-DE",
        },
        saving: false,

        async init() {
          await this.load();
        },

        async load() {
          // TODO: Load from API
        },

        async save() {
          this.saving = true;
          try {
            // TODO: Save to API
            await new Promise(r => setTimeout(r, 500));
            Alpine.store("notifications").add("success", "Einstellungen gespeichert");
          } catch (e) {
            Alpine.store("notifications").add("error", "Fehler beim Speichern");
          } finally {
            this.saving = false;
          }
        },
      };
    }
  </script>
</SettingsLayout>
